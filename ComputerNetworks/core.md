# 网络技术与应用核心知识

## 出题格式

- 单项选择题   (10 题, 20')
- 填空题       (15 空, 15')
- 简答题       (5 题, 30')
- 综合应用题   (4 题, 35')

> 注1: 试卷中包含一张附录, 包括以太网 MAC帧 结构, IPV4 数据包格式, UDP 以及 TCP 报文段格式, 但要求掌握其各个字段的含义
> 注2: 样题为期末考试的参考题型

## 第一、二章

### 1. ***计算机网络*定义** 和 **逻辑上的组成**

- 计算机网络的定义:

    把 **分布在不同地点** 且 **具有独立功能的** 多个计算机通过 **通信设备** 和 **线路** 连接起来, 在 功能完善的 **网络软件运行环境下**, 以 **实现网络中资源共享为目标** 的系统

    计算机网络 = 计算机 + 通信设备 + 连接介质 + 软件系统 + 通信协议

- 计算机网络逻辑上的组成:

    通信子网 + 终端系统(资源子网)

### 2. ***协议*** 的概念以及协议的 ***三要素***

- 网络协议的定义:

    **通信双方必须遵循的**、**控制信息交换的** *规则* 的集合, 是一套 **语义** 和 **语法** *规则*, 用来规定有关功能部件在通信过程中的操作, 它定义了数据发送和接收工作中必经的过程。 协议规定了网络中使用的 **格式、定时方式、顺序和差错控制**。

- 网络协议的三要素:

    - 语法

        指 **数据与控制信息** 的 **结构或格式** , 确定通信时采用的 **数据格式、编码及信号电平** 等

    - 语义

        对构成协议的 **协议元素** 的 **含义** 的解释

    - 同步

        规定了 **事件** 的 **执行顺序**

### 3. **网络体系结构** 的基本概念 和 **OSI/RM** 七个层次的名称(按照顺序)

- 计算机网络体系结构:

    - 是 **计算机网络的分层** 及 **其服务和协议的集合**, 也就是他们所完成的所有功能的定义, 是用户进行 **网络互连** 和 **通信系统设计** 的基础。因此, 体系结构是一个抽象的概念, 它只 **从功能** 上描述计算机网络的结构, 而 **不涉及** 每层的具体组成和实现细节。

- OSI/RM 七个层次(从下到上):

    1. 物理层

        利用 **传输介质** 为通信的网络节点之间 **建立、维护、释放** **物理连接**, 实现 `比特流` 的 **透明传输**, 进而为数据链路层提供 **数据传输服务**

    2. 数据链路层

        在物理层提供服务的基础上, 在通信的 **实体** 间建立 **数据链路链接**, 传输以 `帧` 为单位的 **数据包**, 并采用 **差错控制** 和 **流量控制**方法, 使 **有差错的物理线路** 变成 **无差错的数据链路**

    3. 网络层

        为 **分组交换网络** 上的不同主句提供通信服务, 为以 `分组(packet)` 为单位的数据包通过 **通信子网** 选择适合的路由, 并实现 **拥塞控制** 、**网络互连** 等功能

    4. 传输层

        向用户提供 ***端到端*** 的数据传输服务, 解决对 **上层屏蔽低层** 的 **数据传输** 问题

    5. 会话层

        负责维护通信中两个节点之间的 **会话链接** 的 **建立、维护和断开**, 以及 **数据的交换**

    6. 表示层

        用于处理在两个通信系统中 **交换信息的表示方式**, 主要包括 **数据格式变换、数据的加密与解密、数据压缩与恢复** 等功能

    7. 应用层

        为 **应用程序** 提供 **网络服务**, 它包含了各种用户使用的协议

### 4. 下三层传输的基本单位

- 物理层: `比特`

- 数据链路层: `帧`

- 网络层: `分组`

### 5. TCP/IP 体系结构分层, 区分每个协议位于的层次

- TCP/IP 体系结构分层(从上到下, 括号中是对应的OSI/RM从上到下):

    - 应用层 *application layer* (应用层, 表示层, 会话层)

        - SMTP(简单邮件传输协议 *Simple Mail Transfer Protocol*), TELNET(远程登录网络协议 *Telecommunications Network*), FTP(文件传输协议 *File Transmission Protocol*), HTTP(超文本传输协议 *Hyper Text Transfer Protocol*)

        - SNMP(简单网络管理协议 *Simple Network Management Protocol*), RIP(路由选择信息协议 *Routing Information Protocol*)

    - 传输层 *transport layer* (传输层)

        - TCP(传输控制协议 *Transmission Control Protocol*)

        - UDP(用户数据报协议 *User Datagram Protocol*)

    - 互连网络层 *Internet layer* (网络层)

          - IP(互联网协议 *Internet Protocol*)

          - ICMP(因特网控制消息协议 *Internet Control Message Protocol*), IGMP(因特网组管理协议 *Internet Group Management Protocol*)

            - ARP(地址解析协议 *Address Resolution Protocol*), RARP(反向地址解析协议 *Reverse Address Resolution Protocol*)

    - 网络接入层 *host to network layer* (数据链路层, 物理层)

        - 各类物理网络, 如 FDDI(光纤分布式数据接口 *Fiber Distributed Data Interface*), Ethernet(以太网)

### 一、二章样题

1. 计算机网络按照网络的作用范围进行分类, 可以分为 因特网、广域网、 城域网、 <u>局域网</u> 和个人区域网。

2. 通信双方必须遵循的控制信息交换规则的集合是 (C)

    - A. 服务访问点
    - B. 原语
    - `C`. [协议](##-2.-协议-的概念以及协议的-三要素)
    - D. [网络体系结构](##-3.-网络体系结构-的基本概念-和-OSI/RM-七个层次的名称按照顺序)

3. [网络协议](##-2.-协议-的概念以及协议的-三要素)由语法、语义和 <u>同步</u> 三个要素组成。

4. 下列选项中, <u>不属于</u>[网络体系结构](##-3.-网络体系结构-的基本概念-和-OSI/RM-七个层次的名称)中所描述的内容是 (B)

    - A. 网络层次
    - B. 协议内部实现细节
    - C. 每一层使用协议
    - D. 每层须完成的功能

## 第三章 数据通信技术基础

### 1. 传信速率(比特率)、传码速率(波特率, 调制速率)、发送时延、传播时延的计算

- 传码速率(调制速率、波特率, N<sub>Bd</sub>), 单位: `波特`

    N<sub>Bd</sub> = 1/T (`波特`), **信号码元** 持续时间为 T `秒`

- 传信速率(比特率, R<sub>b</sub>), 单位: `bit/s`, `bps`, `kbps`, `Mbps`

    R<sub>b</sub> = N<sub>Bd</sub> * log<sub>2</sub>M (`bps`)

    一个码元 x 比特, 则 M = 2<sup>x</sup>, M 电平

    传信速率 = 发送速率 = 传输速率 = 信号带宽 (`bps`)

- 发送时延(传输时延), 单位: 秒

    发送时延 = 数据块长度(`b`) / 信道带宽(`bps`) (`s`, 秒)

    从节点进入传输介质所需时间

- 传播时延, 单位: 秒

    传播时延 = 信道长度(`m`) / 电磁波在信道上的传播速度(`m/s`) (秒)

    电磁波在信道中需要传播一定的距离而花费的时间

### 两种信道容量的计算: 香农公式 和 奈氏准则

> 信道容量: 在给定条件, 给定通信路径(或信道)上的 **数据传输速率** (`bps`) 所能达到的最大数据传输速率

- 奈奎斯特公式(无噪声)

    C = 2W * log<sub>2</sub>M (`bps`)

    在理想条件下, 即 **无噪声** 有限带宽为 **W** 的信道, 其最大的 **数据传输速率 C (即信道容量)**

    W: 单位Hz, 一个无噪声的 3000 Hz 的信道, 则 W = 3000 Hz, 每秒传输 2W **码元**

- 香农定理(有噪声)

    C = W * log<sub>2</sub>(1 + S/N)  (`bps`), 这里的 `S/N` 为倍数

    给定带宽 `W(Hz)` 、 信噪功率比 `S/N 倍` 的信道

    (S/N)<sub>dB</sub> = 10 * log<sub>10</sub>(信号功率P1 / 噪声功率P2)

### 3. 常用的传输介质名称

- 有线

    1. 双绞线

    2. 同轴电缆

    3. 光纤

- 无线

    1. 无线电波

    2. 地面微波

    3. 卫星微波

    4. 红外线技术

### 4. 四种多路复用技术的名称, 理解 CDMA 的编码过程

- 多路复用技术

    > **信道复用技术** 是指 在 **一条**传输信道中传输**多路**信号, 以提高 **传输介质利用率** 的技术

    1. 频分复用 *frequency division multiplexing, FDM*

    2. 时分复用 *time division multiplexing, TDM*

    3. 码分复用 *coding division multiplexing, CDM*, 又称为 码分多址复用 *code division multiple access, CDMA*

    4. 波分复用 *wave division multiplexing, WDM*

- CDMA 码分复用/码分多址复用 *code division multiple access*

    - 采用 **扩频(*spread spectrum*)编码原理** 对同时的多路传输加以识别

    - 每个站点被指定一个唯一的 `m 位代码` 或 `切片序列(chip squence)`。

    0. 当发送 **比特 0** 时, 站点送出的是切片序列的 **补码(反码)**

    1. 当发送 **比特 1** 时, 站点送出的是切片序列 **本身**

### 5. 掌握三种基本的数据交换技术名称和应用

1. 电路交换

    也成为线路交换, 应用: **电话交换系统**

    所有电路交换的基本处理过程都包括 **呼叫建立、通信(信息传输)、链接释放** 3 个阶段

2. 报文交换

    应用: **电报通信系统**

3. 分组交换

    应用: **分组交换机互联连而成的分组交换网**

### 6. 关于 CRC 循环冗余检验 *cyclic redundancy checks*

> 循环冗余检验码简称 CRC 码

例3-5: 一个保温的比特序列为 `1101011011`, 通过数据链路传输, 采用 CRC 进行差错检测, 如所用的生成多项式为 g(x) = x<sup>4</sup> + x + 1, 试说明以下问题。

- (1) CRC 码的产生过程及所产生的的发送序列

- (2) CRC 码的检测过程(有差错及无差错)

解:

生成多项式为 g(x) = x<sup>4</sup> + x + 1, 则其编码为 `10011`, 监督位 r = 4。

因为 r = 4, 所以 CRC 校验码是4位的。

对于报文 `1101011011`, 将其左移 4 位, 即在报文末尾加 `4 个 "0"`, 这等于报文乘以 2<sup>4</sup>, 然后被生成多项式 **模2除**。(记住除的过程中, 他们是用异或来算的, 相同为0, 相异为1)


### 第三章样题

1. 若码元周期T = 2e-4 秒, 且传送 8 电平信号, 则传码速率为 <u>5000</u> Bd、传信速率为 <u>15000</u> b/s.

    N<sub>Bd</sub> = 1/T = 1/2e-4 波特 = 5000 波特,
    Rb = N<sub>Bd</sub> * log<sub>2</sub>M = 5000 * 3 bps = 15000 bps

2. 一个 **带宽为4kHz** 的 **理想** 低通信道, 若一个码元携带3bit的信息量, 则最高信息传送速率为 <u>24</u> kb/s.

    C = 2W * log<sub>2</sub>M = 2 * 4000 * 3 bps = 24 kbps.

3. 假设某站点的码片序列为 `11100101`, 则发送了比特 "0" 的时候, 在信道上传输的码片序列是 <sub>00011010</sub>, 发送了比特 "1" 的时候, 码片序列是 <sub>11100101</sub>.

4. 已知带传送的数据 M = 10101, 若采用 CRC 技术进行检错, 生成多项式为 g(x) = x<sup>4</sup> + x + 1, 则冗余码为 <u>1010</u>.

    10101_0000 与 10011 进行模2除, 结果为1010, 生成发送序列 10101\_1010

## 第四章 局域网原理与技术

### 1. 局域网的四个技术特性

1. 传输介质

    传输介质指用于链接网络设备的介质类型

    常用的有 双绞线、同轴电缆、光纤, 无线的有 无线电波、地面微波、卫星微波、红外线技术

2. 传输技术

    传输技术指借助 **传输介质** 进行 **数据通信** 的技术。

    常用的有 **基带传输** 和 **宽带传输** 两种。

    传输技术主要包括 **信道编码**、**调制解调** 以及 **复用技术** 等, 属于 **物理层** 研究的范畴

3. 网络拓扑

    网络拓扑指组网时计算机和通信线缆链接的物理结构和形状

4. 介质访问控制方法

    指多台计算机对传输介质的访问控制方法

    常用的有 **随机争用**、**令牌总线**、**令牌环** 等访问控制方法, 最常用的是 **随机争用**

### 2. CSMA/CD 协议

#### 工作原理

1. 载波监听 *Carrier Sense*

    是指每个计算机在发送数据之前先要检测总线上是否有其他计算机在发送数据, 如果有, 则暂时不发送数据, 以减少发生冲突的机会

2. 多路访问 *Multiple Access*

    指在总线型的局域网中, 有多台计算机链接在一根总线上, 共享总线的信道资源。

3. 冲突检测 *Collision Detect*

    是指发送数据的计算机在发送数据的同时, 还必须监听传输介质, 判断是否发生了冲突

#### 争用期

> 将总线型局域网的端到端忘返时延 `2τ` 称为争用期

例: 假定 100 m 长的 CSMA/CD 网络的数据传输速率为 100 Mbps(即1e8bps)。 设信号在网络上的传播速率为 2e8 m/s, 求能够使用此协议的最短帧长

解:

**争用期** 2τ = 2 * 100 / (2e8) = 1e-6 s

**最短帧长** 为争用期内传输的比特数, 即:

L<sub>min</sub> = 2τ * C = 1e-6 * 1e8 = 100 b

### 有效以太网帧的帧长范围 [64-1518]

`64 <= len(MAC) <= 1518`

### 集线器、以太网交换机(网桥)工作的层次、平均带宽的计算

#### 集线器、以太网交换机(网桥)工作的层次

-  集线器/转发器: 物理层

-  网桥(以太网交换机, 交换式集线器, 第二层交换机): 数据链路层

-  路由器: 网络层

-  网关: 传输层/其他高层

#### 平均带宽的计算

集线器: 平均带宽 = 集线器带宽(bps) / 计算机台数

网桥(以太网交换机): 平均带宽(bps) = 以太网交换机带宽(bps), 注意单位!

例题: (第三次作业 一.3) 若有10台计算机连到了一台 **100Mbps** 的 `集线器` 上, 则每台计算机的平均带宽为 <u>10</u> Mbps。 若该 10 台计算机连到了 **100Mb/s** 的 `以太网交换机` 上, 则每台计算机的平均带宽为 <u>100</u> Mbps。

### 10BASE-T, 10BASE-F, 100BASE-T, 100BASE-F 中 10、100、BASE、T、F的含义

- 10BASE5: 10Mbps 基带信号, 每一段电缆的最大长度为 **500m**

- 10BASE2: 10Mbps 基带信号, 每一段电缆的最大长度为 **200m**

- 10BASE-T: 10Mbps 基带信号, 双绞线

- 10BASE-F: 10Mbps 基带信号, 光纤

- `BASE` 表示电缆上的信号是 **基带信号**, 采用 **曼彻斯特编码**

- BASE 前面的数字 `10` 表示 **数据速率** 为 *10 Mbps*

- 后面的数字, 5 或 2 表示每一段电缆的最大长度为 **500m** 或 **200m**。

- `T` 代表双绞线 *twisted pair, TP*

- `F` 代表光纤 *optical fiber*

### 6. 掌握以太网交换机转发帧的方式以及特点, 理解碎片帧的含义

#### 以太网交换机的工作有三种:

> 碎片帧: 长度小于 64 字节的帧

1. 直通交换方式

    直通交换方式不必将整个数据帧先缓存再进行处理, 而是在接收数据帧的同时就立即按数据帧的 **目的 MAC 地址** 决定该真的转发端口

2. 存储转发方式

    需要将帧完全接受和缓存下来, 然后根据帧头部的 **目的MAC地址** 进行转发

3. 无碎片变换方式

    是直通交换方式的一种改进, 要求交换机只有在收到 **64** 字节以后才开始以直通方式转发帧, 从而避免转发发生冲突而造成的碎片帧

例题: 对于 **100Mbps** 的以太网交换机, 当输出端口无排队, 以直通方式转发一个以太网帧(不包括前导码及帧开始标志)时, 引入的转发延迟至少是 (B)

- A. 0 μs
- B. 0.48 μs
- C. 5μs
- D. 5.12μs

解:

直通方式 有 6 字节, 6 字节 -> 48位, 48b/1e8bps = 0.48μs

无碎片交换方式 有 64 字节, 64 字节 -> 512 位, 512b/1e8bps = 5.12μs

### 7. 理解无线局域网802.11标准中所使用的协议 CSMA/CA 的基本思想

无线局域网采用的是 CSMA/CD 的改进协议 CSMA/CA, 在 CSMA 基础上增加了 **冲突避免机制(*collision avoidance*)** 和 **确认机制**, 即在 IEEE 802.11 使用的 CSMA/CA 协议。

### 第四章样题

1. 局域网采用 CSMA/CD 协议, 传输介质是长度为 1000m 长的电缆, 电缆中的信号传播速度是 2e8 m/s. 若最短帧长为 1000 bit, 求出该局域网的最大传输速率

    2τ = 2 * 1000(m) / 1e8(m/s) = 2e-5 s

    L<sub>min</sub> = 2τ * C = 1000 (bit)

    C = 1000(bit) / (2τ) = 1000 / 2e-5 bps = 5e7 bps

考点回顾: [2. CSMA/CD 协议](#2.-CSMA/CD-协议)

2. 某以太网拓扑及主机的MAC地址如题图所示, 交换机转发表为空, 输出端口无排队帧, 不考虑帧校验延迟。 主机 MAC1 向 主机 MAC3 发送一个数据帧, 主机 MAC3 收到该数据帧后, 向主机 MAC1发送一个确认帧。 写出交换机的转发端口, 并更新交换机的转发表。

![@第二题图 | right](https://raw.githubusercontent.com/KuroiGengetsu/MarkDownPictures/master/Pictures/ComputerNetworks/MAC1MAC2MAC3.png)

-  主机 MAC1 向 主机 MAC3 发送一个数据帧: 交换机会向端口 2, 3 转发 数据帧

转发表

| 目的地址 | 端口 |
| :--: | :--: |
| MAC1 | 端口1 |


- 主机 MAC3 收到该数据帧后, 向主机 MAC1 发送一个确认帧: 交换机会向端口 1 转发确认帧, 该确认帧长度: 64<= 长度 <=1518

| 目的地址 | 端口 |
| :--: | :--: |
| MAC1 | 端口1 |
| MAC3 | 端口3 |

## 第五章 因特网原理与技术

### 1. 会区分一个分类的IP地址类型

IP地址 32 位

![@IP-classful-addressing | center](https://github.com/KuroiGengetsu/MarkDownPictures/blob/master/Pictures/ComputerNetworks/IP-classful-addressing.png?raw=true)

110 是 C 类, 网络号 24 位

### 2. ARP协议的作用及工作原理

地址解析协议 ARP(Address Resolution Protocol)

- 作用: 实现 **因特网地址(IP地址)** 到 **物理地址(MAC地址)** 的映射

？？？

#### RARP协议的作用

逆地址解析协议 RARP(Reverse Address Resolution Protocol)

- 作用: 实现 **物理地址(MAC地址)** 到 **因特网地址(IP地址)** 的映射

### 3. 会分析IP数据包的主要字段

读一读 IP数据报里都有什么, 否则人家问什么都不知道

1. 版本, 4 bit, 包含了创建数据报所用的IP协议的版本信息, **4 就是IPV4**, 6 就是 IPV6

2. 首部长度, 占 4 bit, 以 **四字节为单位** 的IP首部长度, 比如这一字段的数是 5, 那么首部长度就是 5 * 4 = 20

3. 服务类型(TOS), 占 8 bit, 指明应当如何处理数据报(对应第二个十六进制数)

4. 总长度, 占 16 比特, 以字节为单位的整个数据报的长度(对应第3、4个十六进制数)

5. 标识, 16 bit, 源主机赋予数据报的唯一标识符(对应第5、6个十六进制数)

6. 标志, 占 3 bit, 只有 **低两位** 有效。 置 1 时表示数据报不能被分片, 为 0 时 表示数据报允许被分片。 当路由器必须对数据报分片才能转发, 而该数据报的 **DF** 又被置位(为 1) 时, 路由器将抛弃该数据报, 并向其源主机发送一个 ICMP 差错报告。三个比特中的 **最低位** 为 "**更多分片(*more fragments flag, MF*)**", 置位为 **1** 时说明该数据报不是最初是数据报的最后一个分片, 该位复位为 **0** 时, 表示是最后一个分片

7. 片分移量, 占 13 比特, 指出本数据报片中数据相对于 **最初是数据报** 中数据的偏移量, 以 **8 个字节为单位** 计算偏移量。 **还没被分片的数据报** 或者 **第一个数据报分片** 的偏移量为0

8. 生存时间( **TTL** *time to live*), 占一个字节, 对应第九个十六进制数, 数据报没经过一个路由器, 路由器就将其 TTL 值 减一, 并且一旦 TTL 减为 0, 路由器就不再转发该数据报, 而是予以丢弃, 并向数据报的源站发送一个 ICMP 报告

9. 协议, 占 8 比特, 位于第 10 个十六进制数, 指明协议。 查表

10. 首部校验和, 占 16 比特, 用于首部的校验。

11. 源站IP地址 和 目的站 IP 地址, 各站 4 字节, 分别位于 第13~16(源站) 和 第 17~20(目的站) 十六进制数

12. IP选项, 长度可变, 主要用于控制和测试两大目的。

#### 习题 5.20

有个 IP数据报从首部开始的部分内容如图 5-40 所示(十六进制表示), 试标出IP首部和传输层首部, 回答以下问题。

![@图5-40 | center](https://github.com/KuroiGengetsu/MarkDownPictures/blob/master/Pictures/ComputerNetworks/Pic5-40.png?raw=true)


![@IP包解析结果](https://github.com/KuroiGengetsu/MarkDownPictures/blob/master/Pictures/ComputerNetworks/Pic5-7.png?raw=true)

一个十六进制数为 8 bit

一行有 32bit, 也就是四个十六进制数

1. 数据报首部长度和总长度各为多少字节?

    读取第一个十六进制数, 是 `45`, 即 **版本4** , 首部长度 5 * 4 (字节/bit) = 20 字节, 长度为 20 字节

    后边的 `00` 是服务类型, 再往后的 `02 79` 是总长度, 折合成十进制是 633, 所以总长是 633

2. 数据报的协议字段是多少? 表示什么意思?

    协议是在 第 10 个十六进制数, `06`, 所以 转换为 10 进制是 6， 查看 `指定的网际协议编号表` 就知道, 6 对应 TCP协议

| 协议字段值 | 1 | 2 | 3 | 4 | 6 | 8 | 17 | 88 | 89 |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| 协议名 | ICMP | IGMP | GGP | IP | TCP | EGP | UDP | IGRP | OSPF |

3. 源站IP地址和目的站IP地址分别是什么? (用点分十进制表示)

    源站IP地址在第 13 个十六进制数 到 第 16 个, 即 `0A 0A 01 5F`, 转换为 十进制就是 10.10.1.95, 是 A 类地址

4. TTL、校验和字段是多少?

    **TTL** 也就是 **生存时间**, 对应 **第九个** 十六进制数 `80`, 即 128; 校验和为 `00 00`

5. 源端口和宿端口是什么? 并推测所应用的应用层协议是什么?

???

### 数据报分片原理与计算

#### 课后题 5.12

一个数据报长度为 4000 字节(包含固定长度的首部), 现在经过一个网络传送, 但此网络能够传送的最大数据长度为 1500 字节。 试问应当划分为几个短些的数据报片? 各数据报片的数据字段长度、片偏移字段和MF标志应为何值?

固定长度的首部: 20 字节, 分的片数 = ceil(4000 / (MTU1500 - 首部20)), 其中 ceil 函数为向上取整函数, 所以计算结果为3, 因此要分 3 片

- 第一片: 数据长度 = 1500 - 20 = 1480, MF = 1, 片偏移量 = 0, 总长度 = 1500

- 第二片: 数据长度 = 1500 - 20 = 1480, MF = 1, 片偏移量 = 1480 / 80 = 185, 总长度 = 1500

- 第三片: 数据长度 = 4000 - 20 - 1480 * 2 = 1020, MF = 0, 片偏移量 = 185 * 2 = 370, 总长度 = 1020 + 20 = 1040

### 子网的划分和计算

子网掩码、每个子网的子网地址、每个子网容纳的主机数、每个子网最小的IP地址、最大的IP地址及广播地址

> 子网编址: 从主机域中 **借用** 若干个比特作为 **子网号(subnet-id)**, 而 **主机号(host-id)** 也就相应减少了若干个比特。

IP地址 = 网络号 + 子网号 + 主机号

#### 子网掩码

> 子网编码(mask): 子网号的位数是可变的, 为了反映有多少位用于表示子网号, 采用 **子网掩码(*mask*)**

`IP地址 = [网络号, 子网号, 主机号]`
`子网掩码 = [11...11, 11...11, 00..00]`

例题: 假如在一个 B 类网络 128.10.0.0 中, 我们准备从 16 位主机号部分里借用 3 位 进行子网划分, 求对应的 **子网掩码**。

- 分析: 因为是 B 类网络, 所以网络号部分是16位, 又因为子网号部分是 3 位, 所以子网掩码里就有 16 + 3 = 19位 1, 剩下的 32 - 19 = 13 位主机号部分为 **全0**

- 结果: `11111111 11111111 11100000 00000000`, 转换为点分十进制就是 `255.255.224.0`

#### 子网地址

例题: 假如一台主机的 IP地址是 128.10.32.6, 子网掩码是 255.255.224.0, 那么该主机所在子网的子网地址又是什么呢?

- 分析: 子网地址也是一个特殊的IP地址, 就是网络号部分和子网号部分不变, 主机号部分全零的地址。 `&` 与 运算

- 结论: 子网地址 = 主机IP地址 & 子网掩码, 与运算

- 答案: 子网地址 = (128 & 255).(10 & 255).(32 & 224).(6 & 0) = 128.10.32.0

需要注意的就是 32 & 224 时, 也就是 00100000 & 11100000 = 00100000, 前缀代表是二进制

#### 广播地址

##### 基本概念

- 用途: 要用广播的方式发送一个分组时, 目的IP地址是一个广播地址

- 特点: 主机号部分全1

- 问题: 在子网 128.10.32.0 中, 广播地址为多少?

- 分析: 把**主机号部分**(13位)变为 **全1**: 128.10.00111111.11111111, 即 128.10.63.255

##### 例题

问题: 一家公司申请到的网络地址是 `202.119.230.0`, 现在由于工作上的需要, 要把该网络划分为14个子网, 并且又希望每个子网的规模尽可能的大, 则应选用的子网掩码是多少?

> 若 全0、 全1的子网地址可以分配: 则借用 **x位** 进行子网划分, 可以划分出 2<sup>x</sup>个子网
> 若 全0、 全1的子网地址不可以分配: 则可以划分出 2<sup>x</sup>-2 个子网

本题中 x = 4 满足要求, 因为是 C 类地址, 所以其子网掩码是 24 + 4 = 28 比特 的 1, 32 - 28 = 4 比特的 0

答案: 子网掩码为 255.255.255.11110000, 即 255.255.255.240

##### 例题2

问题: 设有一个网络, 其网络地址为 210.10.30.0, 若其选用的子网掩码是 255.255.255.192, 则:

1. 可以划分多少个子网?(全0全1的子网地址不匹配)
2. 每个子网容纳的主机个数是多少?
3. 每个子网的子网地址分别是什么?
4. 每个子网中可分配的IP地址的范围是多少? 广播地址是多少?

分析:

1. 网络地址, 210 转化为二进制是 `11010010`, 是 C 类地址, 所以网络号有 24 位, 子网掩码 255.255.255.1100 0000, 主机号有六位(零的个数), 所以有两位用来当作子网号, 由于全0全1的子网地址不匹配, 所以可以划分为 2<sup>2</sup>-2 = 2 个子网

2. 由于主机号有6位, 所以每个子网有 2<sup>6</sup>-2 = 62 个主机个数

3. 一个是 210.10.30.128, 另一个是 210.10.30.64

4. 有两个子网:

    - 先说第一个子网, 210.10.30.10 000000, 由于全0全1的不用, 所以 最小的是210.10.30.10 000001, 最大的是 210.10.30.10 100000, 即最小的是 210.10.30.129, 最大的是 210.10.30.160, 广播地址是主机号全为 1 的地址, 即 210.10.30.10 111111, 也就是 210.10.30.191

    - 第二个子网, 也就是 210.10.30.01 000000, 由于全0全1的不用, 所以最小的是 210.10.30.01 000001, 最大的是 210.10.30.01 100000, 即最小的是 210.10.30.65, 最大的是 210.10.30.96,广播地址是主机号全为 1 的地址, 即 210.10.30.01 111111, 也就是 210.10.30.127

### 6. 掌握 CIDR地址块中地址个数的计算, 掌握路由的汇聚, 路由最长前缀匹配。

#### 无分类域间路由选择 CIDR *classless inter-domain routing*

地址块的CIDR记法 也称 **斜线记法**, 斜线 `/` 后面的数值表示  **网络前缀的长度**

例5-7. 某个ISP拥有地址快 202.118.0.0/15, 先后有 5 个单位申请地址块, 单位A需要 1800 个地址, 单位B需要 900 个地址, 单位C需要 900 个地址, 单位 D 需要 400 个地址, 单位 E 需要 3500 个地址, 该怎样分配地址块?

对于单位A, 1800 个地址需要 11 个比特标识主机, 因此这个单位的IP地址前缀长度应该是 32 - 11 = 21, 同理, ABCD 的网络前缀长度应分别为 22、 22、 23、 20.

> CIDR 记法的其他形式: 20.0.0.0/10 可简写为 20/10, 也就是将点分十进制中低位连续的 0 省略。

地址数, A: 2<sup>11</sup>, B: 2<sup>10</sup>, C: 2<sup>10</sup>, D: 2<sup>9</sup>, E: 2<sup>12</sup>

#### 路由的汇聚 *route aggregation*

> 路由聚合分块是将 几个不同的无分类编制,展开写成二进制字符串, 找到他们网络前缀中最大的相同部分, 并将最大的相同部分作为聚合之后的网络前缀

> 意义: 将路由聚合之后的无分类编制或聚合地址放入路由表中, 能够代表更多的地址块, 使表达更加简洁。

#### 路由最长前缀匹配

貌似并没有要求掌握

### 7. 掌握 ICMP 的原理及其在 PING 中的应用

#### ICMP

ICMP(*Internet Control Message Protocol*) 是因特网控制报文协议

它是 **IP层的协议**

有两种: **差错报告报文** 和 **询问报文**

**ICMP 差错报告报文** 共有 5 种: 终点不可达, 源站抑制, 时间超过, 参数问题, 改变路由(重定向)

ICMP 询问报文一般是询问和应答成对使用的

#### PING(Package InterNet Grouper)

**PING** 用来测试两个主机之间的连通性

PING 使用了 **ICMP** 回送请求与回送回答报文

PING 是 **应用层** 直接使用 **网络层** ICMP 的例子, 他没有通过运输层的TCP 或 UDP

### 8. 掌握 **内部网关协议** 和 **外部网关协议** 的含义, 能够列举出两类路由选择协议的代表性协议名称

1. **内部网关协议 *IGP***

    把一个自治系统 **内部** 路由器交换路由信息所用的 **任何协议** 统称为内部网关协议。

    常用的IGP 有: **RIP、OSPF 和 IGRP**

2. **外部网关协议 *EGP***

    两个自治系统 **之间** 传递网络可达性信息所用的协议称为外部网关协议。

    唯一在使用的 EGP 协议是 **BGP-4**

### 9. RIP的基本概念

> 路由信息协议(*routing information protocol, RIP*) 是内部网关协议中 **最先** 得到广泛使用的协议, RIP 使用一种 **距离向量算法更新路由表**, 常用于小型的自治系统

#### 算法名称 **距离向量算法更新路由表**

RIP协议是通过“距离”的定义, 来实现对最短路径的寻找。它认为一个好的路由就是它通过的路由器的数目少, 即“距离短”

### 10. 实现 VPN 用到的技术

#### 隧道传输技术 + 加密技术

#### 网络地址转换 NAT(*Network Address Translation*)

NAT(网络地址转换) 提供一种机制将使用 **专用IP地址的域** 和 **使用全球唯一注册IP地址的外部域** 连通。

装有 NAT 软件的 路由器叫做 **NAT路由器**, 他至少有一个有效的外部全球抵制 IP<sub>G</sub>

### 11. IPV6 中 IP 地址的长度是 128 位, 如何通过 **零压缩法** 表示IPV6地址, IPV6 地址的种类(单薄、多播、任播)

#### 特点:

- 更大的地址空间。IPv6 将地址从 IPv4 的 32 bit 增大到了 128 bit

- 扩展的地址层次结构

- 灵活的首部格式

    **固定首部 40 字节**

- 改进的选项

- 允许协议继续扩充

- 支持即插即用（即自动配置）

- 支持资源的预分配

#### 零压缩法

> 使用 `::` 表示一个或多个连续的 `16 比特 0`, 在任何一个地址中只能使用 **一次零压缩**

记住一共 8 个十六进制数, 每个十六进制数有 16 比特

所以问 `::` 代表了多少个 **比特位0**, 应用 128 - 16 * 现有的十六进制个数

例 5-10: 将下列地址记法进行零压缩:

- 单播地址: `2001:DB8:0:0:8:800:200C:417A`

    答: `2001:DB8::8:800L:200C:417A`
    其中 `::` 代表了 128 - 6 * 16 = 32 个比特位 0

- 组播地址: `FF01:0:0:0:0:0:0:101`

    答： `FF01::101`
    其中 `::` 代表了 128 - 2 * 16 = 96 个比特位 0

- 回送地址: `0:0:0:0:0:0:0:1`

    答: `::1`
    其中 `::` 代表了 128 - 1 * 16 = 112 个比特位 0

- 未指定地址: `0:0:0:0:0:0:0:0`

    答: `::`
    其中 `::` 代表了 128 - 0 * 16 = 128 个比特位 0

#### IPV6 中地址的种类

1. 单播 *unicast*

2. 任播 *anycast*

3. 组播 *multicast*

### 样题

1. 在 IPV4 中, 一个数据报总长度为 3000 字节(固定长度的首部), 现在经过 MTU = 1500 字节的网络传送, 则该数据报被划分数据报片个数是 ceil(3000 / (1500 - 40)) = 3 个

2. 网络上 IP 地址和端口号组合, 称为 **套接字**。

3. 主机甲 与 主机乙 之间建立一个 TCP 链接, 甲向乙发送了两个连续的报文段, 分别包含 300 字节 和 500 字节的有效载荷, 第一个报文段的序号为1, 主机乙正确接收到两个段后, 发送给主机甲的确认号为


???

4. RIP协议是基于 <u>距离向量算法更新路由表</u> 的路由算法

5. 如果需要从主机 H1 访问因特网, 题图中的路由器 R1 需要执行那个协议?

![@主机H1访问因特网](https://github.com/KuroiGengetsu/MarkDownPictures/blob/master/Pictures/ComputerNetworks/Chapter5-5.png?raw=true)

**NAT**


6. 已知网络号是 192.168.60.0, 要在此网络中划分2个一样大的子网, 且每个子网规模尽可能的大(不可以使用全1全0的子网)。 请写出子网掩码, 所有子网的子网地址和子网广播地址。

    192.169.60.0, 192 即 11000000, 所以是 C 类地址, 有24位网络号, 所以 子网是 192.168.60. 10000000 和 192.168.60.01000000, 即 192.168.60.128 和 192.168.60.64, 子网掩码 11111111.11111111.11111111.11000000, 即 255.255.255.192; 广播地址, 192.168.60.10 111111 和 192.168.60.01 111111, 即 192.168.60.191 和 192.168.60.127

考点: [子网的划分和计算](#子网的划分和计算)

## 第六章 应用与开发技术

### 1. 域名系统的作用

> 因特网的域名系统 *DNS* 是一个分布式数据库联机系统, 采用 **C/S应用模式**

> 作用: 主机可以通过域名服务程序将域名解析到特定的IP地址。

### 2. 理解 FTP 应用的两个链接名称和作用, 理解为什么 FTP 服务器可以同时相应多个客户端的请求

> FTP 使用 **面向连接的 C/S服务模式**, 使用两条 **TCP链接** 来完成文件传输, 一条链接专用于控制(端口号为21), 另一条为数据连接(端口号为20)。

1. 控制链接

2. 数据连接

FTP 服务器进程:

    1. 主进程: 负责接收客户的请求

    2. 从属进程: 负责处理请求, 并按需可有多个从属进程

    主进程与从属进程是并发式工作方式

### 3. 一台计算机访问因特网需要配置的项目, 和 DHCP 的基本概念

#### 配置的项目

配置 **IP地址 、 子网掩码 、 默认网关 、 域名服务器的IP地址**

#### 动态主机配置协议 DHCP *Dynamic Host Configuration protocol*

> DHCP 允许一台计算机加入新网可自动获取IP地址, 不用人工参与

> DHCP 使用 **C/S 服务模式**

### 4. 理解发送电子邮件的过程, 掌握其中使用的应用层协议名称

如 SMTP, POP3, IMAP4, MIME

![@电子邮件系统的组成](https://github.com/KuroiGengetsu/MarkDownPictures/blob/master/Pictures/ComputerNetworks/Mail.png?raw=true)

从左到右 SMTP, SMTP, POP3/MIME

简单邮件传输协议 SMTP *Simple Mail Transfer Protocol*

邮局协议第三版本 POP3 *Post Office Protocol v3*

因特网邮件访问协议第四版本 IMAP4 *Internet Message Access Protocol v4*

通用因特网邮件扩展 MINE *Multipurpose Internet Mail Extensions*

### 5. 理解 WWW 和 HTTP URL 的基本概念

万维网 *WWW* *World Wide Web*

超文本传输协议 *HTTP* *Hyper Text Transfer Protocol*

统一资源定位符 *URL* *Uniform Resource Locator*

### 6. 解析传输层、 网络层、 数据链路层的协议报文

### 7. UDP协议

#### UDP 的特点

1. UDP 是 **无连接的**

2. UDP 提供 **不可靠的服务**

3. UDP **同时** 支持 **点到点** 和 **多点** 之间的通信

4. UDP 的 **首部** 只有 **8** 个字节

5. UDP 是 **面向报文** 的

### 8. TCP

#### TCP 的 特点

1. TCP 是 **面向连接的**

2. TCP 提供 **可靠的服务**

3. TCP 只能进行 **点到点** 的通信

4. TCP 的 **首部** **固定部分** 是 `20` 个字节, 最长可达 **60** 字节

5. TCP 是 **面向字节流** 的
